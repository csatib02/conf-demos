<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Logs Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
        }

        .header {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        h1 {
            color: #4ec9b0;
            font-size: 1.5em;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        button:hover {
            background: #1177bb;
        }

        button.active {
            background: #16825d;
        }

        .filter-group {
            display: flex;
            gap: 5px;
        }

        .log-container {
            background: #1e1e1e;
            border: 1px solid #3c3c3c;
            border-radius: 8px;
            height: calc(100vh - 160px);
            overflow-y: auto;
            padding: 15px;
        }

        .log-entry {
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #0e639c;
            background: #252526;
            border-radius: 4px;
            font-size: 0.85em;
            line-height: 1.6;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .log-entry.status-200 {
            border-left-color: #4ec9b0;
        }

        .log-entry.status-error {
            border-left-color: #f48771;
            background: #2d1f1f;
        }

        .log-entry.status-304 {
            border-left-color: #dcdcaa;
        }

        .log-timestamp {
            color: #858585;
            font-size: 0.8em;
        }

        .log-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .log-method {
            background: #0e639c;
            color: white;
        }

        .log-method.GET {
            background: #4ec9b0;
        }

        .log-method.POST {
            background: #dcdcaa;
            color: #1e1e1e;
        }

        .log-status {
            background: #858585;
            color: white;
        }

        .log-status.success {
            background: #4ec9b0;
        }

        .log-status.error {
            background: #f48771;
        }

        .log-status.redirect {
            background: #dcdcaa;
            color: #1e1e1e;
        }

        .log-path {
            color: #569cd6;
            font-weight: 500;
        }

        .no-logs {
            text-align: center;
            color: #858585;
            padding: 40px;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #3c3c3c;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4c4c4c;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>ðŸ“‹ Frontend Log-viewer</h1>
        </div>
        <div class="controls">
            <div class="filter-group">
                <button id="filterAll" class="active" onclick="filterLogs('all')">All</button>
                <button id="filterSuccess" onclick="filterLogs('success')">Success</button>
                <button id="filterErrors" onclick="filterLogs('errors')">Errors</button>
            </div>
            <button id="autoScrollBtn" class="active" onclick="toggleAutoScroll()">Auto-scroll</button>
            <button onclick="clearLogs()">Clear</button>
            <button onclick="refreshLogs()">Refresh</button>
        </div>
    </div>

    <div class="log-container" id="logContainer">
        <div class="no-logs">Waiting for logs...</div>
    </div>

    <script>
        let autoScroll = true;
        let previousLogCount = 0;
        let currentFilter = 'all';
        let allLogs = [];

        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            const btn = document.getElementById('autoScrollBtn');
            btn.classList.toggle('active', autoScroll);
        }

        function filterLogs(filter) {
            currentFilter = filter;
            ['filterAll', 'filterSuccess', 'filterErrors'].forEach(id => {
                document.getElementById(id).classList.remove('active');
            });
            document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`).classList.add('active');
            renderLogs();
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '<div class="no-logs">Logs cleared. Waiting for new logs...</div>';
            allLogs = [];
        }

        function scrollToBottom() {
            if (autoScroll) {
                const container = document.getElementById('logContainer');
                container.scrollTop = container.scrollHeight;
            }
        }

        function getStatusClass(statusCode) {
            if (statusCode >= 200 && statusCode < 300) return 'success';
            if (statusCode >= 300 && statusCode < 400) return 'redirect';
            if (statusCode >= 400) return 'error';
            return '';
        }

        function formatLog(log) {
            const statusCode = log.status_code || 0;
            const method = log.http_method || '';
            const path = log.http_path || log.message || 'N/A';
            const statusClass = getStatusClass(statusCode);
            const DEFAULT_CLASS = 'log-entry';

            let entryClass = DEFAULT_CLASS
            if (statusCode === 200) entryClass += ' status-200';
            else if (statusCode === 304) entryClass += ' status-304';
            else if (statusCode >= 400) entryClass += ' status-error';

            let parts = [];

            if (log.timestamp) {
                const date = new Date(log.timestamp);
                parts.push(`<span class="log-timestamp">${date.toLocaleTimeString()}</span>`);
            }

            if (method) {
                parts.push(`<span class="log-badge log-method ${method}">${method}</span>`);
            }

            if (statusCode) {
                parts.push(`<span class="log-badge log-status ${statusClass}">${statusCode}</span>`);
            }

            parts.push(`<span class="log-path">${escapeHtml(path)}</span>`);

            if (log.event) {
                parts.push(`<span class="log-badge" style="background: #569cd6;">${escapeHtml(log.event)}</span>`);
            }

            if (log.variant) {
                parts.push(`<span class="log-badge" style="background: #c586c0;">${escapeHtml(log.variant)}</span>`);
            }

            if (entryClass === DEFAULT_CLASS) {
                return '';
            }
            return `<div class="${entryClass}">${parts.join(' ')}</div>`;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function renderLogs() {
            const container = document.getElementById('logContainer');

            let filteredLogs = allLogs;
            if (currentFilter === 'success') {
                filteredLogs = allLogs.filter(log => {
                    const status = log.status_code || 0;
                    return status >= 200 && status < 400;
                });
            } else if (currentFilter === 'errors') {
                filteredLogs = allLogs.filter(log => {
                    const status = log.status_code || 0;
                    return status >= 400;
                });
            }

            if (filteredLogs.length === 0) {
                container.innerHTML = '<div class="no-logs">No logs match the current filter...</div>';
            } else {
                container.innerHTML = filteredLogs.map(log => formatLog(log)).join('');
            }

            scrollToBottom();
        }

        async function refreshLogs() {
            try {
                const response = await fetch('/api/logs');
                const logs = await response.json();

                if (logs.length > previousLogCount) {
                    allLogs = logs;
                    renderLogs();
                }
                previousLogCount = logs.length;

            } catch (error) {
                console.error('Error fetching logs:', error);
            }
        }

        setInterval(refreshLogs, 1000);
        refreshLogs();
    </script>
</body>
</html>
